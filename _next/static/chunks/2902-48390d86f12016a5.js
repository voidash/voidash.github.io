"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2902],{2902:(e,t,o)=>{o.d(t,{U:()=>c,V:()=>s});var r=o(2115),l=o(550),n=o(9708),i=o(3510),a=o(1419);function s(e,t){let[o,s]=(0,r.useState)(t||new Date().toISOString().split("T")[0]),[c,d]=(0,r.useState)(!1),[u,g]=(0,r.useState)(""),[f,p]=(0,r.useState)(!1),[w,m]=(0,r.useState)(void 0),[y,h]=(0,r.useState)(!1),[S,v]=(0,r.useState)(""),[b,x]=(0,r.useState)(null),[D,k]=(0,r.useState)([]),[_,E]=(0,r.useState)(null),[C,I]=(0,r.useState)(null);async function M(e){let t=[];for(let r of e){let e=(0,n.P)((0,n.rJ)(l.db,"todos"),(0,n._M)("text","==",r.text),(0,n._M)("label","==",r.label),(0,n._M)("sourceDate","==",o)),i=await (0,n.GG)(e);i.empty||t.push(i.docs[0].id)}return t}async function G(){let e=(0,i.Z7)(u,o),t=new Map;for(let e of D)try{let o=(0,n.H9)(l.db,"todos",e),r=await (0,n.x7)(o);if(r.exists()){let o=r.data(),l="".concat(o.text,"|").concat(o.label);t.set(l,{docId:e,todo:o})}}catch(e){console.error("Error fetching previous todo:",e)}let r=new Map;for(let t of e){let e="".concat(t.text,"|").concat(t.label);r.set(e,t)}for(let[e,i]of r.entries()){let r=t.get(e);if(r){if(r.todo.completed!==i.completed)try{let e=(0,n.H9)(l.db,"todos",r.docId),t={completed:i.completed};i.completed?t.completedDate=new Date().toISOString().split("T")[0]:t.completedDate=null,await (0,n.mZ)(e,t)}catch(e){console.error("Error updating todo:",e)}}else try{let e={text:i.text,label:i.label,sourceDate:o,completed:i.completed,createdAt:new Date().toISOString()};i.completed&&(e.completedDate=new Date().toISOString().split("T")[0]),await (0,n.gS)((0,n.rJ)(l.db,"todos"),e)}catch(e){console.error("Error adding todo:",e)}}for(let[e,{docId:o}]of t.entries())if(!r.has(e))try{let e=(0,n.H9)(l.db,"todos",o);await (0,n.kd)(e)}catch(e){console.error("Error deleting todo:",e)}k(await M(e))}(0,r.useEffect)(()=>{e&&t();async function t(){try{let e=(0,n.P)((0,n.rJ)(l.db,"daily_logs"),(0,n._M)("date","==",o)),t=await (0,n.GG)(e);if(t.empty)x(null),d(!1),g(""),p(!1),m(void 0),h(!1),k([]);else{let e=t.docs[0],r=e.data();x(e.id),d(r.logged),g(r.tasksMarkdown),p(r.gymSession),m(r.weight),h(r.caloriesTracked);let l=(0,i.Z7)(r.tasksMarkdown,o),n=await M(l);k(n)}}catch(e){console.error("Error loading log:",e)}}},[o,e]),(0,r.useEffect)(()=>{e&&t();async function t(){try{let e=function(e){let t=new Date(e),o=t.getDay(),r=t.getDate()-o+(0===o?-6:1);return new Date(t.setDate(r)).toISOString().split("T")[0]}(o),t=(0,n.P)((0,n.rJ)(l.db,"weekly_logs"),(0,n._M)("weekStart","==",e)),r=await (0,n.GG)(t);r.empty?E(null):E(r.docs[0].data());let i=function(e){let t=new Date(e);return t.setDate(t.getDate()-1),t.toISOString().split("T")[0]}(o),a=(0,n.P)((0,n.rJ)(l.db,"daily_logs"),(0,n._M)("date","==",i)),s=await (0,n.GG)(a);s.empty?I(null):I(s.docs[0].data())}catch(e){console.error("Error fetching context:",e)}}},[o,e]);let O=(0,r.useMemo)(()=>{if(!u.trim())return null;let e=(0,i.Zg)(u),t=(0,i.zP)(e),r=(0,i.Z7)(u,o);return{totalTasks:e.length,completedTasks:e.filter(e=>e.completed).length,learningArtifacts:t.learningArtifacts,revisionNotesCreated:t.revisionNotesCreated,revisionPointsReviewed:t.revisionPointsReviewed,publicOutputs:t.publicOutputs,newInteractions:t.newInteractions,familyCalls:t.familyCalls,conflictsResolved:t.conflictsResolved,unresolvedConflicts:t.unresolvedConflicts,todosAdded:r.length}},[u,o]);async function T(){if(!e)return;let t=(0,i.OA)(u,o);if(console.log("\uD83D\uDCDA Extracted learning items:",t.length,t),0===t.length)return void console.log("ℹ️ No learning items found (no #learn or #review tags in completed tasks)");for(let r of t)try{console.log("\uD83D\uDD0D Checking if learning item exists:",r.text);let t=(0,n.P)((0,n.rJ)(l.db,"learning_items"),(0,n._M)("userId","==",e),(0,n._M)("text","==",r.text)),i=await (0,n.GG)(t);if(i.empty){console.log("➕ Creating new learning item for date:",o);let t=(0,a.qy)(e,r.text,o,r.sourceType);console.log("   Source date:",o,"→ Next review:",t.nextReviewDate);let i=await (0,n.gS)((0,n.rJ)(l.db,"learning_items"),t);console.log("✓ Created learning item with ID:",i.id)}else{console.log("✏️ Updating existing learning item");let e=i.docs[0],t=e.data().relatedDates||[];t.includes(o)?console.log("ℹ️ Date already in relatedDates"):(await (0,n.mZ)((0,n.H9)(l.db,"learning_items",e.id),{relatedDates:[...t,o]}),console.log("✓ Updated relatedDates"))}}catch(e){console.error("❌ Error syncing learning item:",e),console.error("Item that failed:",r)}}async function P(){if(!e)return v("Error: You must be logged in"),!1;v("Saving...");try{let e={date:o,logged:c,tasksMarkdown:u,gymSession:f,caloriesTracked:y,createdAt:new Date().toISOString()};if(null!=w&&(e.weight=w),b){let t=(0,n.H9)(l.db,"daily_logs",b);await (0,n.mZ)(t,e),v("✓ Updated")}else await (0,n.gS)((0,n.rJ)(l.db,"daily_logs"),e),v("✓ Saved");return await G(),await T(),setTimeout(()=>v(""),2e3),!0}catch(e){return console.error("Error saving log:",e),v("Error saving log"),!1}}return{date:o,logged:c,tasksMarkdown:u,gymSession:f,weight:w,caloriesTracked:y,status:S,existingLogId:b,weeklyLog:_,previousDayLog:C,taskStats:O,setDate:s,setLogged:d,setTasksMarkdown:g,setGymSession:p,setWeight:m,setCaloriesTracked:h,saveLog:P,loadLog:function(e){s(e.date),d(e.logged),g(e.tasksMarkdown),p(e.gymSession),m(e.weight),h(e.caloriesTracked),x(e.id)}}}function c(e){let[t,o]=(0,r.useState)([]),[i,a]=(0,r.useState)(!0);async function s(e){if(!confirm("Are you sure you want to delete this daily log?"))return!1;try{return await (0,n.kd)((0,n.H9)(l.db,"daily_logs",e)),o(t.filter(t=>t.id!==e)),!0}catch(e){return console.error("Error deleting log:",e),!1}}return(0,r.useEffect)(()=>{if(!e){o([]),a(!1);return}!async function(){try{a(!0);let e=(0,n.P)((0,n.rJ)(l.db,"daily_logs"),(0,n.My)("date","desc")),t=(await (0,n.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));o(t)}catch(e){console.error("Error fetching logs:",e)}finally{a(!1)}}()},[e]),{allLogs:t,loading:i,deleteLog:s,refreshLogs:async function(){if(e)try{let e=(0,n.P)((0,n.rJ)(l.db,"daily_logs"),(0,n.My)("date","desc")),t=(await (0,n.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));o(t)}catch(e){console.error("Error refreshing logs:",e)}}}}},3510:(e,t,o)=>{function r(e){let t=e.split("\n"),o=[];for(let e of t){let t=e.match(/^[\s-]*\[([x X ])\]\s*(.*)$/i);if(t){let e="x"===t[1].toLowerCase(),r=t[2].trim(),l=(r.match(/#[\w-]+/g)||[]).map(e=>e.toLowerCase());o.push({completed:e,text:r,tags:l})}}return o}function l(e){let t=e.filter(e=>e.completed);return{learningArtifacts:t.filter(e=>e.tags.includes("#learn")).length,revisionPointsReviewed:t.filter(e=>e.tags.includes("#review")).length,revisionNotesCreated:t.filter(e=>e.tags.includes("#new-review")).length,publicOutputs:t.filter(e=>e.tags.includes("#produce")).length,newInteractions:t.filter(e=>e.tags.includes("#relationship")).length,gymSessions:t.filter(e=>e.tags.includes("#gym")).length,familyCalls:t.filter(e=>e.tags.includes("#family")).length,conflictsResolved:t.filter(e=>e.tags.includes("#conflict-resolved")).length,unresolvedConflicts:t.filter(e=>e.tags.includes("#conflict-unresolved")).length}}function n(e,t){let o=r(e),l=[],n={"#learning-todo":"learning","#producer-todo":"producer","#finance-todo":"finance","#fitness-todo":"fitness","#relationship-todo":"relationship"};for(let e of o)for(let[o,r]of Object.entries(n))if(e.tags.includes(o)){let n=e.text.replace(o,"").trim();l.push({text:n,label:r,sourceDate:t,completed:e.completed,createdAt:new Date().toISOString()});break}return l}function i(e){let t=r(e).filter(e=>e.completed),o="none";t.some(e=>e.tags.includes("#finance-concept"))&&(o="implemented");let l="none",n=t.some(e=>e.tags.includes("#ips-check")),i=t.some(e=>e.tags.includes("#portfolio-review"));return n?l="ips_checked":i&&(l="reviewed"),{financeConceptApplied:o,portfolioReview:l}}function a(e,t){let o=r(e).filter(e=>e.completed),l=[];for(let e of o)if(e.tags.includes("#learn")){let t=e.text.replace(/#learn/g,"").trim();l.push({text:t,sourceType:"learn"})}else if(e.tags.includes("#review")&&!e.tags.includes("#new-review")){let t=e.text.replace(/#review/g,"").trim();l.push({text:t,sourceType:"review"})}return l}o.d(t,{Kk:()=>i,OA:()=>a,Z7:()=>n,Zg:()=>r,zP:()=>l})}}]);